import sys
import pstats


def main(argv: list[str]):
    if len(argv) != 2:
        raise ValueError(
            "this python code expects only one parameter: file.prof;"
           +" wich is generated by an execution python3 -m cProfile.\n"
           +" sample: python3 digest.py some_file.prof"
        )
    file_profile = argv[1]
    p = pstats.Stats(file_profile)

    stats = p.get_stats_profile() 

    tottime_sign_message = stats.func_profiles['sign_message_entrypoint'].tottime
    tottime_verify_message = stats.func_profiles['verify_message_entrypoint'].tottime

    file_name = file_profile.split(".")[0]
    file_csv = file_name + '.csv'
    with open(file_csv, 'w') as f:
        f.write(f"sign_message, {tottime_sign_message}\n")
        f.write(f"verify_message, {tottime_verify_message}\n")


if __name__ == "__main__":
    main(sys.argv)
